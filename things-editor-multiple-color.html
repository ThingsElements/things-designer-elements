<link rel="import" href="../polymer/polymer.html">

<link rel="import" href="../iron-resizable-behavior/iron-resizable-behavior.html">

<link rel="import" href="./things-editor-color.html">

<!--
색상 배열을 편집하는 컴포넌트이다.

새로운 색상을 추가하고자 할 때는 `+` 버튼을 클릭한다.<br />
색상을 제거하고자 할 때는 `-` 버튼을 클릭한다.<br />

Example:

    <things-editor-multiple-color values="{{values}}">
    </things-editor-multiple-color>

@demo demo/index-editor-multiple-color.html
@hero hero.svg
-->

<dom-module id="things-editor-multiple-color">
  <template>
    <style>
      :host {
        display: block;
        @apply(--things-editor-multiple-color)
      }

      #multiple-color {
        clear:both;
        margin-bottom:-3px;
        @apply(--things-editor-colorbar-container)
      }

    </style>

    <template is="dom-if" if="[[_isArray(values)]]">
      <template is="dom-repeat" items="[[values]]">
        <div>

          <input type="button" value="+" on-click="_appendEditorColor" data-index="[[index]]">

          <things-editor-color value="{{item}}">
          </things-editor-color>

          <template is="dom-if" if="[[!_isOnly(item, index)]]">
            <input type="button" value="-" on-click="_removeEditorColor" data-index="[[index]]">
          </template>
        </div>
      </template>
    </template>
    <template is="dom-if" if="[[!_isArray(values)]]">
      <div>

        <input type="button" value="+" on-click="_appendEditorColor" data-index="[[index]]">

        <things-editor-color value="{{values}}">
        </things-editor-color>

      </div>
    </template>

  </template>

  <script>

    Polymer({
      is: 'things-editor-multiple-color',

      behaviors: [
        Polymer.IronResizableBehavior
      ],

      properties: {
        /**
         *
         */

        values: {
          type: Array,
          value: [],
          notify: true
        }
      },

      listeners: {
        // 'iron-resize': '_onIronResize',
        'change' : '_onValueChanged'
      },

      observers: [

      ],

      _onValueChanged: function(e) {

        if(this._changedBySelf === true){
          this._changedBySelf = false
          return
        }

        var values = this.values

        this.set('values', values)
      },

      _appendEditorColor: function(e) {
        var values = this.values;

        if( typeof values == 'string')
          values = [values]

        var index = e.target.dataIndex || 0
        values.splice(index + 1, 0, 'black')

        this.values = []
        this.async(function(){
          this._changedBySelf = true
          this.values = values
          this.fire('change', e)
        }, 1)
      },

      _removeEditorColor: function(e){
        var values = []
        for(var i=0; i<this.values.length; i++){
          if(i === e.target.dataIndex)
            continue;
          else
            values.push(this.values[i])
        }

        this.values = []
        this.async(function(){
          this._changedBySelf = true
          this.values = values
          this.fire('change', e)
        }, 1)
      },

      _isOnly: function(item, index){
        if(this.values.length === 1)
          return true

        return false
      },

      _isArray: function(items){
        if(typeof items == 'object' && items.length > 0)
          return true

        return false
      }

    })

  </script>
</dom-module>
