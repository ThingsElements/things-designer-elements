<!--
@license
Copyright Â© HatioLab Inc. All rights reserved.
-->

<link rel="import" href="../polymer/polymer.html">

<link rel="import" href="./things-editor-color.html">
<link rel="import" href="./things-editor-color-stops.html">
<link rel="import" href="./things-editor-multiple-color.html">
<link rel="import" href="./things-editor-color-style.html">
<link rel="import" href="./things-editor-number-input.html">
<link rel="import" href="./things-editor-angle-input.html">
<link rel="import" href="./things-editor-table.html">
<link rel="import" href="./things-editor-action.html">
<link rel="import" href="./things-editor-script.html">

<!--
An element providing a solution to no problem in particular.

Example:

@demo demo/index-editor-property.html
@hero hero.svg
-->

<dom-module id="things-editor-property">
  <template>
    <style>
      :host {
      }

      things-editor-script{
        width:94%;height:180px;
        margin:-7px 0 7px 7px;
        overflow:auto;
      }

      select{
        @apply(--things-select);
        background:url(/images/bg-input-select.png) 100% 50% no-repeat #fff;
      }
    </style>

    <template is="dom-if" if="[[_isExist(label)]]" restamp=true>
      <label>[[label]]</label>
    </template>

    <template is="dom-if" if="[[_isTypeofEditor(type, 'legend')]]" restamp=true>
      <legend>[[property.label]]</legend>
    </template>

    <template is="dom-if" if="[[_isTypeofEditor(type, 'number')]]" restamp=true>
      <things-editor-number-input number="{{value::change}}">
        <input placeholder="[[placeholder]]">
      </things-editor-number-input>
    </template>

    <template is="dom-if" if="[[_isTypeofEditor(type, 'angle')]]" restamp=true>
      <things-editor-angle-input radian="{{value::change}}">
        <input placeholder="[[placeholder]]">
      </things-editor-angle-input>
    </template>

    <template is="dom-if" if="[[_isTypeofEditor(type, 'string')]]" restamp=true>
      <input type="text" value="{{value::change}}" placeholder="[[placeholder]]">
    </template>

    <template is="dom-if" if="[[_isTypeofEditor(type, 'textarea')]]" restamp=true>
      <things-editor-script theme="ace/theme/monokai"
                            value="{{value}}">
      </things-editor-script>
    </template>

    <template is="dom-if" if="[[_isTypeofEditor(type, 'checkbox')]]" restamp=true>
      <input type="checkbox" checked="{{value::change}}" placeholder="[[placeholder]]">
    </template>

    <template is="dom-if" if="[[_isTypeofEditor(type, 'select')]]" restamp=true>
      <select value="{{value::change}}">
        <template is="dom-repeat" items="[[property.options]]">
          <option value$="[[item]]">[[item]]</option>
        </template>
      </select>
    </template>

    <template is="dom-if" if="[[_isTypeofEditor(type, 'color')]]" restamp=true>
      <things-editor-color value="{{value::change}}" placeholder="[[placeholder]]"/>
    </template>

    <template is="dom-if" if="[[_isTypeofEditor(type, 'solid-color-stops')]]" restamp=true>
      <things-editor-color-stops type="solid" value="{{value::change}}" min="[[property.min]]" max="[[property.max]]"/>
    </template>

    <template is="dom-if" if="[[_isTypeofEditor(type, 'gradient-color-stops')]]" restamp=true>
      <things-editor-color-stops type="gradient" value="{{value::change}}" min="[[property.min]]" max="[[property.max]]"/>
    </template>

    <template is="dom-if" if="[[_isTypeofEditor(type, 'multiple-color')]]" restamp=true>
      <things-editor-multiple-color values="{{value::change}}"/>
    </template>

    <template is="dom-if" if="[[_isTypeofEditor(type, 'chartjs-properties')]]" restamp=true>
      <things-editor-chartjs-properties values="{{value}}"/>
    </template>

    <template is="dom-if" if="[[_isTypeofEditor(type, 'action')]]" restamp=true>
      <things-editor-action icon="[[property.icon]]" action="[[property.action]]"/>
    </template>

    <template is="dom-if" if="[[_isTypeofEditor(type, 'image-selector')]]" restamp=true>
      <things-image-selector
        on-things-image-changed="_onThingsImageChanged"
        label="[[label]]"
        detail-fields=""
        display-field="[[property.displayField]]"
        display-full-url="[[property.displayFullUrl]]"
        base-url-alias="[[property.baseUrlAlias]]"
        value="{{value}}"
        default-storage="[[property.defaultStorage]]"
        storage-filters="[[property.storageFilters]]"
        use-upload="[[property.useUpload]]">
      </things-image-selector>
    </template>

    <template is="dom-if" if="[[_isTypeofEditor(type, 'editor-table')]]" restamp=true>
      <things-editor-table></things-editor-table>
    </template>

  </template>

  <script>

    class ThingsEditorProperty extends Polymer.Element {
      static get is() { return 'things-editor-property'; }

      static get properties() {
        return {
          value: {
            notify: true,
            observer: '_valueChanged'
          },
          type: String,
          label: String,
          property: {
            type: Object,
            notify: true,
            value: function (){ return {} }
          }
        }
      }

      _isTypeofEditor(editorType, type) {
        return editorType == type
      }

      _isExist(label) {
        var str = String(label || "")
        return label != ""
      }

      _valueChanged(value) {
        if(!this.get('observe'))
          return

        this.get('observe').call(this, value)
      }

      _onThingsImageChanged(e) {
        if(!this.property)
          return

        this.set("value", e.detail)
        this.dispatchEvent(new Event('change', { bubbles: true, composed: true }));
      }
    }
    window.customElements.define(ThingsEditorProperty.is, ThingsEditorProperty);    
  </script>
</dom-module>
