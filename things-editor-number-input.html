<!--
@license
Copyright © HatioLab Inc. All rights reserved.
-->
<link rel="import" href="../polymer/polymer.html">

<!--
Number 값이 undefined 또는 NaN인 경우에 Exception을 방지하기 위한 input의 확장 엘리먼트이다.

Example:

  <things-editor-number-input number="{{number}}">
    <input>
  </things-editor-number-input>

@demo demo/index-editor-number-input.html
@hero hero.svg
-->

<dom-module id="things-editor-number-input">
  <template>
    <style>
      :host {
        display: inline-block;
      }
    </style>
    <slot id="content" on-change="_onChangeValue"></slot>
  </template>

  <script>
  (function() {
    'use strict';

    Polymer({
      is: 'things-editor-number-input',

      properties: {

        number: {
          type: Number,
          notify: true,
          reflectToAttribute: true,
          observer: "_onChangeNumber"
        }
      },

      attached() {
        this._observer = Polymer.dom(this).observeNodes(function(info) {
          this._initSlottedInput();
        }.bind(this));
      },
      
      detached() {
        if (this._observer) {
          Polymer.dom(this).unobserveNodes(this._observer);
          this._observer = null;
        }
      },

      /**
       * Returns the distributed <input> element.
       */
      get inputElement () {
        return this._inputElement;
      },

      _initSlottedInput: function() {
        this._inputElement = this.getEffectiveChildren()[0];
        if(!this._inputElement)
          return;

        this._inputElement.setAttribute('type', 'number');

        this._onChangeNumber(this.number);
      },

      _onChangeNumber(number) {
        if(!this.inputElement)
          return;

        /* 외부에서 바인딩된 변수의 값을 바꾼 경우 */
        if(isNaN(Number(number))) {
          this.inputElement.value = NaN;
        } else {
          this.inputElement.value = Number(number);
        }
      },

      _onChangeValue(e) {
        /* 에디터에서 값을 바꾼 경우 */
        var value = this.inputElement.valueAsNumber;

        if(isNaN(Number(value))) {
          this.number = NaN;
        } else {
          this.number = Number(value);
        }

        e.stopPropagation();
        this.dispatchEvent(new CustomEvent('change', { bubbles: true, composed: true }));
      }
    });
  })();
  </script>
</dom-module>
